import express from "express";
import bodyParser from "body-parser";
import contactList from "./contactList";

const app = express()

const my_contact_list = new contactList();

my_contact_list.add({
  name: "Marco",
  phone: 4283818844
})

my_contact_list.add({
  name: "Frank",
  phone: 4283819955
})

my_contact_list.add({
    name: "Lana",
    phone: 4567123490
  })

app.use(express.static(__dirname + '/public'))
app.use(bodyParser.json());

// respond with "hello world" when a GET request is made to the homepage

//get all contacts
app.get('/contacts', function (req, res) {
  if(req.query.name && req.query.name.length > 0){
    const search_result = my_contact_list.searchBy("name",
    req.query.name);

    if(req.query.limit){
      let limit = parseInt(req.query.limit);
      res.send(search_result.slice(0,limit));
    }

    if(req.query.sort === "mr"){
      //console.log(my_contact_list.getList());
       res.send(search_result.sort(function(obj1, obj2){
          return obj2.timeStamp - obj1.timeStamp;
       }))
    }

    if(req.query.sort === "lr"){
      //console.log(my_contact_list.getList());
       res.send(search_result.sort(function(obj1, obj2){
          return obj1.timeStamp - obj2.timeStamp;
       }))
    }
    res.send(search_result)
  }else if (req.query.phone && req.query.phone.length > 0){
    const search_result = my_contact_list.searchBy("phone",
    req.query.phone);
    res.send(search_result)
  }else{
    res.send(my_contact_list.getList());
  }
})

//GET one contact
app.get('/contacts/:id', function (req, res) {
  // TODO: need some validation
  res.send(my_contact_list.getList()[req.params.id]);
})

//create one contact
app.post('/contacts', function (req, res) {
  // TODO: create a new contact, we can use isValid method
  console.log("req.body", req.body);
  my_contact_list.add(req.body)
  res.send(my_contact_list.getList());
})

//delete contact
app.delete('/contacts/:name', function (req, res){
 my_contact_list.remove(req.params.name)
 res.send(my_contact_list.getList());
})

app.listen(3000, function () {
 console.log('Example app listening on port 3000!')
})